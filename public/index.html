<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fondamentale</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #0f0f23 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .title {
            font-size: 3rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #a0a0c9;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }

        .status-bar {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 12px;
            padding: 12px 20px;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 30px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #4ade80;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .search-box {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 8px;
            padding: 10px 15px;
            color: white;
            width: 300px;
            font-size: 14px;
        }

        .search-box::placeholder {
            color: #a0a0c9;
        }

        .refresh-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            color: white;
            cursor: pointer;
            font-weight: 600;
            transition: transform 0.2s;
        }

        .refresh-btn:hover {
            transform: translateY(-2px);
        }

        .table-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid rgba(102, 126, 234, 0.2);
            backdrop-filter: blur(10px);
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
        }

        th, td {
            padding: 15px 12px;
            text-align: left;
            border-bottom: 1px solid rgba(102, 126, 234, 0.1);
        }

        th {
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: background 0.2s;
            position: relative;
        }

        th:hover {
            background: rgba(102, 126, 234, 0.2);
        }

        .sort-arrow {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0.5;
            font-size: 12px;
        }

        tbody tr {
            transition: background 0.2s;
        }

        tbody tr:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .ticker {
            font-family: monospace;
            font-weight: 600;
            color: #667eea;
        }

        .price {
            font-weight: 600;
            font-family: monospace;
        }

        .status-undervalued {
            background: rgba(74, 222, 128, 0.2);
            color: #4ade80;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-overvalued {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .percentage {
            font-weight: 600;
            font-family: monospace;
        }

        .percentage.positive {
            color: #4ade80;
        }

        .percentage.negative {
            color: #f87171;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #a0a0c9;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(102, 126, 234, 0.3);
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .footer {
            text-align: center;
            margin-top: 40px;
            color: #a0a0c9;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .title {
                font-size: 2rem;
            }
            
            .controls {
                flex-direction: column;
                align-items: stretch;
            }
            
            .search-box {
                width: 100%;
            }
            
            .table-container {
                overflow-x: auto;
            }
            
            th, td {
                padding: 10px 8px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1 class="title">Fondamentale</h1>
            <p class="subtitle">Real-time stock analysis with multiple valuation models</p>
            <div class="status-bar">
                <div class="status-dot"></div>
                <span>Real-time Data â€¢ Click refresh to update</span>
            </div>
        </header>

        <div class="controls">
            <input type="text" class="search-box" placeholder="Search stocks..." id="searchInput">
            <button class="refresh-btn" onclick="refreshData()">ðŸ”„ Refresh Data</button>
        </div>

        <div class="table-container">
            <table id="stockTable">
                <thead>
                    <tr>
                        <th onclick="sortTable(0)">Company Name <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(1)">Ticker <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(2)">DCF Value <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(3)">P/E Value <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(4)">Asset Value <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(5)">Current Price <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(6)">Status <span class="sort-arrow">â†•</span></th>
                        <th onclick="sortTable(7)">% Difference <span class="sort-arrow">â†•</span></th>
                    </tr>
                </thead>
                <tbody id="stockTableBody">
                    <tr>
                        <td colspan="8" class="loading">
                            <div class="spinner"></div>
                            Loading stock data...
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <footer class="footer">
            <p>Click refresh button to update data â€¢ Powered by Yahoo Finance API</p>
            <p>Disclaimer: This is for educational purposes only. Not financial advice.</p>
        </footer>
    </div>

    <script>
        // Real Yahoo Finance data integration via Vercel API
        let stockData = [];
        let sortColumn = 8;
        let sortDirection = -1; // -1 for descending, 1 for ascending

        const API_BASE_URL = 'https://fondamentale.vercel.app/api';

        // Stock symbols to track
        const stockSymbols = [
            // Technology
            'AAPL', 'MSFT', 'GOOGL', 'AMZN', 'META', 'TSLA', 'NVDA', 'NFLX', 'ADBE', 'CRM',
            'ORCL', 'IBM', 'INTC', 'CSCO', 'QCOM', 'AMD', 'NOW', 'SNOW', 'PLTR', 'ZM',
            
            // Healthcare & Pharmaceuticals
            'JNJ', 'PFE', 'UNH', 'ABT', 'TMO', 'DHR', 'BMY', 'AMGN', 'GILD', 'BIIB',
            'MRNA', 'REGN', 'VRTX', 'ILMN', 'ISRG', 'ZTS', 'CVS', 'CI', 'HUM', 'ANTM',
            
            // Financial Services
            'JPM', 'BAC', 'WFC', 'GS', 'MS', 'C', 'USB', 'PNC', 'TFC', 'COF',
            'AXP', 'BLK', 'SCHW', 'CME', 'ICE', 'SPGI', 'MA', 'V', 'PYPL',
            
            // Consumer Goods & Retail
            'WMT', 'HD', 'PG', 'KO', 'PEP', 'NKE', 'SBUX', 'MCD', 'DIS', 'COST',
            'TGT', 'LOW', 'TJX', 'DLTR', 'ROST', 'BBY', 'GPS', 'ANF', 'UAA', 'LULU',
            
            // Energy & Utilities
            'XOM', 'CVX', 'COP', 'EOG', 'SLB', 'PSX', 'VLO', 'MPC', 'OXY', 'DVN',
            'NEE', 'DUK', 'SO', 'D', 'EXC', 'SRE', 'AEP', 'XEL', 'PEG', 'ED',
            
            // Industrial & Manufacturing
            'BA', 'CAT', 'GE', 'MMM', 'HON', 'UPS', 'RTX', 'LMT', 'NOC', 'GD',
            'FDX', 'UNP', 'CSX', 'NSC', 'DAL', 'UAL', 'AAL', 'LUV', 'JBLU', 'ALK',
            'GOOG', 'AVGO', 'BRK.B', 'LLY', 'ABBV', 'TMUS', 'PM', 'LIN', 'BX', 'MRK', 
            'T', 'UBER', 'VZ', 'INTU', 'TXN', 'BKNG', 'ANET', 'GEV', 'ACN', 'BSX', 
            'SYK', 'PGR', 'ETN', 'MU', 'APH', 'DE', 'AMAT', 'PANW', 'LRCX', 'CMCSA', 
            'KKR', 'ADI', 'ADP', 'MDT', 'KLAC', 'MO', 'WELL', 'SNPS', 'CB', 'CRWD', 
            'PLD', 'DASH', 'MMC', 'RCL', 'CEG', 'PH', 'CDNS', 'AMT', 'HCA', 'TT', 'WM', 
            'SHW', 'ORLY', 'MCK', 'CTAS', 'DELL', 'NEM', 'ABNB', 'MDLZ', 'AON', 'TDG', 
            'MSI', 'ECL', 'COIN', 'APO', 'AJG', 'ITW', 'EQIX', 'FI', 'BK', 'EMR', 'RSG', 
            'MAR', 'ELV', 'WMB', 'AZO', 'HWM', 'JCI', 'SPG', 'CL', 'ADSK', 'APD', 'HLT', 
            'VST', 'FCX', 'WDAY', 'URI', 'TRV', 'TEL', 'MNST', 'FTNT', 'KMI', 'NXPI', 'AXON', 
            'DLR', 'GLW', 'AFL', 'FAST', 'ROP', 'COR', 'CMG', 'PWR', 'GM', 'CARR', 'BDX', 'CMI', 
            'NDAQ', 'MET', 'O', 'ALL', 'PCAR', 'LHX', 'PSA', 'IDXX', 'DHI', 'CTVA', 'PAYX', 'SQ', 
            'AMP', 'GWW', 'OKE', 'EW', 'DDOG', 'CBRE', 'CPRT', 'F', 'GRMN', 'AIG', 'KR', 'BKR', 
            'MSCI', 'CCI', 'FANG', 'TTWO', 'EA', 'KMB', 'AME', 'CCL', 'EBAY', 'YUM', 'CHTR', 'RMD', 
            'MPWR', 'KVUE', 'LVS', 'KDP', 'ETR', 'LYV', 'ROK', 'PRU', 'SYY', 'VMC', 'CSGP', 'TKO', 
            'VRSK', 'HSY', 'HIG', 'MLM', 'FICO', 'FIS', 'TRGP', 'VICI', 'A', 'STX', 'CAH', 'CTSH', 
            'MCHP', 'LEN', 'XYL', 'WEC', 'NUE', 'ACGL', 'OTIS', 'RJF', 'GEHC', 'PCG', 'KHC', 'WAB', 
            'EL', 'TSCO', 'STT', 'IQV', 'EQT', 'DD', 'BRO', 'WTW', 'EXR', 'ODFL', 'IR', 'MTB', 'VTR', 
            'EFX', 'FITB', 'ADM', 'BR', 'HPE', 'DXCM', 'AWK', 'WBD', 'STZ', 'SYF', 'DTE', 'NRG', 'KEYS', 
            'WDC', 'AVB', 'IBKR', 'K', 'ROL', 'IRM', 'WRB', 'AEE', 'PPL', 'MTD', 'TTD', 'HPQ', 'ATO', 
            'FOXA', 'EXPE', 'GIS', 'VLTO', 'IP', 'HBAN', 'PHM', 'EQR', 'PTC', 'VRSN', 'FOX', 'TDY', 
            'FE', 'PPG', 'NTRS', 'SMCI', 'CBOE', 'SW', 'CNP', 'DOV', 'RF', 'TYL', 'STE', 'DRI', 'CINF', 
            'DG', 'PODD', 'ES', 'TROW', 'NVR', 'LDOS', 'LH', 'CPAY', 'EXE', 'WSM', 'HUBB', 'CHD', 'CFG', 
            'NTAP', 'ULTA', 'SBAC', 'JBL', 'EIX', 'CDW', 'GPN', 'TPL', 'CMS', 'KEY', 'TPR', 'ZBH', 'FSLR', 
            'GDDY', 'DGX', 'ON', 'TSN', 'L', 'NI', 'AMCR', 'LII', 'PKG', 'GPC', 'HAL', 'STLD', 'INVH', 'TRMB', 
            'IT', 'MKC', 'TER', 'WY', 'CTRA',


        ];

        // Company names mapping
const companyNames = {
            // Technology
            'AAPL': 'Apple Inc.', 'MSFT': 'Microsoft Corp.', 'GOOGL': 'Alphabet Inc.', 'AMZN': 'Amazon.com Inc.',
            'META': 'Meta Platforms', 'TSLA': 'Tesla Inc.', 'NVDA': 'NVIDIA Corp.', 'NFLX': 'Netflix Inc.',
            'ADBE': 'Adobe Inc.', 'CRM': 'Salesforce Inc.', 'ORCL': 'Oracle Corp.', 'IBM': 'IBM Corp.',
            'INTC': 'Intel Corp.', 'CSCO': 'Cisco Systems', 'QCOM': 'Qualcomm Inc.', 'AMD': 'Advanced Micro Devices',
            'NOW': 'ServiceNow Inc.', 'SNOW': 'Snowflake Inc.', 'PLTR': 'Palantir Technologies', 'ZM': 'Zoom Video',
            
            // Healthcare
            'JNJ': 'Johnson & Johnson', 'PFE': 'Pfizer Inc.', 'UNH': 'UnitedHealth Group', 'ABT': 'Abbott Laboratories',
            'TMO': 'Thermo Fisher Scientific', 'DHR': 'Danaher Corp.', 'BMY': 'Bristol-Myers Squibb', 'AMGN': 'Amgen Inc.',
            'GILD': 'Gilead Sciences', 'BIIB': 'Biogen Inc.', 'MRNA': 'Moderna Inc.', 'REGN': 'Regeneron Pharmaceuticals',
            'VRTX': 'Vertex Pharmaceuticals', 'ILMN': 'Illumina Inc.', 'ISRG': 'Intuitive Surgical', 'ZTS': 'Zoetis Inc.',
            'CVS': 'CVS Health Corp.', 'CI': 'Cigna Corp.', 'HUM': 'Humana Inc.', 'ANTM': 'Anthem Inc.',
            
            // Financial
            'JPM': 'JPMorgan Chase', 'BAC': 'Bank of America', 'WFC': 'Wells Fargo', 'GS': 'Goldman Sachs',
            'MS': 'Morgan Stanley', 'C': 'Citigroup Inc.', 'USB': 'U.S. Bancorp', 'PNC': 'PNC Financial',
            'TFC': 'Truist Financial', 'COF': 'Capital One Financial', 'AXP': 'American Express', 'BLK': 'BlackRock Inc.',
            'SCHW': 'Charles Schwab', 'CME': 'CME Group Inc.', 'ICE': 'Intercontinental Exchange', 'SPGI': 'S&P Global',
            'MA': 'Mastercard Inc.', 'V': 'Visa Inc.', 'PYPL': 'PayPal Holdings',
            
            // Consumer
            'WMT': 'Walmart Inc.', 'HD': 'Home Depot', 'PG': 'Procter & Gamble', 'KO': 'Coca-Cola Co.',
            'PEP': 'PepsiCo Inc.', 'NKE': 'Nike Inc.', 'SBUX': 'Starbucks Corp.', 'MCD': 'McDonald\'s Corp.',
            'DIS': 'Walt Disney Co.', 'COST': 'Costco Wholesale', 'TGT': 'Target Corp.', 'LOW': 'Lowe\'s Companies',
            'TJX': 'TJX Companies', 'DLTR': 'Dollar Tree Inc.', 'ROST': 'Ross Stores', 'BBY': 'Best Buy Co.',
            'GPS': 'Gap Inc.', 'ANF': 'Abercrombie & Fitch', 'UAA': 'Under Armour', 'LULU': 'Lululemon Athletica',
            
            // Energy
            'XOM': 'Exxon Mobil', 'CVX': 'Chevron Corp.', 'COP': 'ConocoPhillips', 'EOG': 'EOG Resources',
            'SLB': 'Schlumberger Ltd.', 'PSX': 'Phillips 66', 'VLO': 'Valero Energy', 'MPC': 'Marathon Petroleum',
            'OXY': 'Occidental Petroleum', 'DVN': 'Devon Energy', 'NEE': 'NextEra Energy', 'DUK': 'Duke Energy',
            'SO': 'Southern Co.', 'D': 'Dominion Energy', 'EXC': 'Exelon Corp.', 'SRE': 'Sempra Energy',
            'AEP': 'American Electric Power', 'XEL': 'Xcel Energy', 'PEG': 'Public Service Enterprise', 'ED': 'Consolidated Edison',
            
            // Industrial
            'BA': 'Boeing Co.', 'CAT': 'Caterpillar Inc.', 'GE': 'General Electric', 'MMM': '3M Company',
            'HON': 'Honeywell International', 'UPS': 'United Parcel Service', 'RTX': 'Raytheon Technologies', 'LMT': 'Lockheed Martin',
            'NOC': 'Northrop Grumman', 'GD': 'General Dynamics', 'FDX': 'FedEx Corp.', 'UNP': 'Union Pacific',
            'CSX': 'CSX Corp.', 'NSC': 'Norfolk Southern', 'DAL': 'Delta Air Lines', 'UAL': 'United Airlines',
            'AAL': 'American Airlines', 'LUV': 'Southwest Airlines', 'JBLU': 'JetBlue Airways', 'ALK': 'Alaska Air Group',
            'GOOG': 'Alphabet Inc.', 'AVGO': 'Broadcom Inc.', 'BRK.B': 'Berkshire Hathaway Inc.', 'LLY': 'Eli Lilly and Company', 
            'ABBV': 'AbbVie Inc.', 'TMUS': 'T-Mobile US, Inc.', 'PM': 'Philip Morris International Inc.', 'LIN': 'Linde plc', 
            'BX': 'Blackstone Inc.', 'MRK': 'Merck & Co., Inc.', 'T': 'AT&T Inc.', 'UBER': 'Uber Technologies, Inc.',
            'VZ': 'Verizon Communications Inc.', 'INTU': 'Intuit Inc.', 'TXN': 'Texas Instruments Incorporated', 
            'BKNG': 'Booking Holdings Inc.', 'ANET': 'Arista Networks Inc', 'GEV': 'GE Vernova Inc.', 'ACN': 'Accenture plc', 
            'BSX': 'Boston Scientific Corporation', 'SYK': 'Stryker Corporation', 'PGR': 'The Progressive Corporation', 
            'ETN': 'Eaton Corporation plc', 'MU': 'Micron Technology, Inc.', 'APH': 'Amphenol Corporation', 
            'DE': 'Deere & Company', 'AMAT': 'Applied Materials, Inc.', 'PANW': 'Palo Alto Networks, Inc.', 'LRCX': 'Lam Research Corporation', 
            'CMCSA': 'Comcast Corporation', 'KKR': 'KKR & Co. Inc.', 'ADI': 'Analog Devices, Inc.', 'ADP': 'Automatic Data Processing, Inc.', 
            'MDT': 'Medtronic plc', 'KLAC': 'KLA Corporation', 'MO': 'Altria Group, Inc.', 'WELL': 'Welltower Inc.', 'SNPS': 'Synopsys, Inc.', 
            'CB': 'Chubb Limited', 'CRWD': 'CrowdStrike Holdings, Inc.', 'PLD': 'Prologis, Inc.', 'DASH': 'DoorDash, Inc.', 
            'MMC': 'Marsh & McLennan Companies, Inc.', 'RCL': 'Royal Caribbean Cruises Ltd.', 'CEG': 'Constellation Energy Corporation', 
            'PH': 'Parker-Hannifin Corporation', 'CDNS': 'Cadence Design Systems, Inc.', 'AMT': 'American Tower Corporation', 'HCA': 'HCA Healthcare, Inc.', 
            'TT': 'Trane Technologies plc', 'WM': 'Waste Management, Inc.', 'SHW': 'The Sherwin-Williams Company', 'ORLY': "O'Reilly Automotive, Inc.", 
            'MCK': 'McKesson Corporation', 'CTAS': 'Cintas Corporation', 'DELL': 'Dell Technologies Inc.', 'NEM': 'Newmont Corporation', 
            'ABNB': 'Airbnb, Inc.', 'MDLZ': 'Mondelez International, Inc.', 'AON': 'Aon plc', 'TDG': 'TransDigm Group Incorporated', 
            'MSI': 'Motorola Solutions, Inc.', 'ECL': 'Ecolab Inc.', 'COIN': 'Coinbase Global, Inc.', 'APO': 'Apollo Global Management, Inc.', 
            'AJG': 'Arthur J. Gallagher & Co.', 'ITW': 'Illinois Tool Works Inc.', 'EQIX': 'Equinix, Inc.', 'FI': 'Fiserv, Inc.', 
            'BK': 'The Bank of New York Mellon Corporation', 'EMR': 'Emerson Electric Co.', 'RSG': 'Republic Services, Inc.', 'MAR': 'Marriott International, Inc.', 
            'ELV': 'Elevance Health, Inc.', 'WMB': 'The Williams Companies, Inc.', 'AZO': 'AutoZone, Inc.', 'HWM': 'Howmet Aerospace Inc.', 
            'JCI': 'Johnson Controls International plc', 'SPG': 'Simon Property Group, Inc.', 'CL': 'Colgate-Palmolive Company', 'ADSK': 'Autodesk, Inc.', 
            'APD': 'Air Products and Chemicals, Inc.', 'HLT': 'Hilton Worldwide Holdings Inc.', 'VST': 'Vistra Corp.', 'FCX': 'Freeport-McMoRan Inc.', 
            'WDAY': 'Workday, Inc.', 'URI': 'United Rentals, Inc.', 'TRV': 'The Travelers Companies, Inc.', 'TEL': 'TE Connectivity plc', 
            'MNST': 'Monster Beverage Corporation', 'FTNT': 'Fortinet, Inc.', 'KMI': 'Kinder Morgan, Inc.', 'NXPI': 'NXP Semiconductors N.V.', 
            'AXON': 'Axon Enterprise, Inc.', 'DLR': 'Digital Realty Trust, Inc.', 'GLW': 'Corning Incorporated', 'AFL': 'Aflac Incorporated', 
            'FAST': 'Fastenal Company', 'ROP': 'Roper Technologies, Inc.', 'COR': 'Cencora, Inc.', 'CMG': 'Chipotle Mexican Grill, Inc.', 
            'PWR': 'Quanta Services, Inc.', 'GM': 'General Motors Company', 'CARR': 'Carrier Global Corporation', 'BDX': 'Becton, Dickinson and Company', 
            'CMI': 'Cummins Inc.', 'NDAQ': 'Nasdaq, Inc.', 'MET': 'MetLife, Inc.', 'O': 'Realty Income Corporation', 'ALL': 'The Allstate Corporation', 
            'PCAR': 'PACCAR Inc', 'LHX': 'L3Harris Technologies, Inc.', 'PSA': 'Public Storage', 'IDXX': 'IDEXX Laboratories, Inc.', 
            'DHI': 'D.R. Horton, Inc.', 'CTVA': 'Corteva, Inc.', 'PAYX': 'Paychex, Inc.', 'SQ': 'Block, Inc.  # corrected from XYZ', 
            'AMP': 'Ameriprise Financial, Inc.', 'GWW': 'W.W. Grainger, Inc.', 'OKE': 'ONEOK, Inc.', 'EW': 'Edwards Lifesciences Corporation', 
            'DDOG': 'Datadog, Inc.', 'CBRE': 'CBRE Group, Inc.', 'CPRT': 'Copart, Inc.', 'F': 'Ford Motor Company', 'GRMN': 'Garmin Ltd.', 
            'AIG': 'American International Group, Inc.', 'KR': 'The Kroger Co.', 'BKR': 'Baker Hughes Company', 'MSCI': 'MSCI Inc.', 
            'CCI': 'Crown Castle Inc.', 'FANG': 'Diamondback Energy, Inc.', 'TTWO': 'Take-Two Interactive Software, Inc.', 
            'EA': 'Electronic Arts Inc.', 'KMB': 'Kimberly-Clark Corporation', 'AME': 'AMETEK, Inc.', 'CCL': 'Carnival Corporation & plc', 
            'EBAY': 'eBay Inc.', 'YUM': 'Yum! Brands, Inc.', 'CHTR': 'Charter Communications, Inc.', 'RMD': 'ResMed Inc.', 
            'MPWR': 'Monolithic Power Systems, Inc.', 'KVUE': 'Kenvue Inc.', 'LVS': 'Las Vegas Sands Corp.', 'KDP': 'Keurig Dr Pepper Inc.', 
            'ETR': 'Entergy Corporation', 'LYV': 'Live Nation Entertainment, Inc.', 'ROK': 'Rockwell Automation, Inc.', 'PRU': 'Prudential Financial, Inc.', 
            'SYY': 'Sysco Corporation', 'VMC': 'Vulcan Materials Company', 'CSGP': 'CoStar Group, Inc.', 'TKO': 'TKO Group Holdings, Inc.', 
            'VRSK': 'Verisk Analytics, Inc.', 'HSY': 'The Hershey Company', 'HIG': 'The Hartford Insurance Group, Inc.', 'MLM': 'Martin Marietta Materials, Inc.', 
            'FICO': 'Fair Isaac Corporation', 'FIS': 'Fidelity National Information Services, Inc.', 'TRGP': 'Targa Resources Corp.', 
            'VICI': 'VICI Properties Inc.', 'A': 'Agilent Technologies, Inc.', 'STX': 'Seagate Technology Holdings plc', 'CAH': 'Cardinal Health, Inc.', 
            'CTSH': 'Cognizant Technology Solutions Corporation', 'MCHP': 'Microchip Technology Incorporated', 'LEN': 'Lennar Corporation', 'XYL': 'Xylem Inc.', 
            'WEC': 'WEC Energy Group, Inc.', 'NUE': 'Nucor Corporation', 'ACGL': 'Arch Capital Group Ltd.', 'OTIS': 'Otis Worldwide Corporation', 
            'RJF': 'Raymond James Financial, Inc.', 'GEHC': 'GE HealthCare Technologies Inc.', 'PCG': 'PG&E Corporation', 'KHC': 'The Kraft Heinz Company', 
            'WAB': 'Westinghouse Air Brake Technologies Corporation', 'EL': 'The EstÃ©e Lauder Companies Inc.', 'TSCO': 'Tractor Supply Company', 
            'STT': 'State Street Corporation', 'IQV': 'IQVIA Holdings Inc.', 'EQT': 'EQT Corporation', 'DD': 'DuPont de Nemours, Inc.', 
            'BRO': 'Brown & Brown, Inc.', 'WTW': 'Willis Towers Watson Public Limited Company', 'EXR': 'Extra Space Storage Inc.', 
            'ODFL': 'Old Dominion Freight Line, Inc.', 'IR': 'Ingersoll Rand Inc.', 'MTB': 'M&T Bank Corporation', 'VTR': 'Ventas, Inc.', 
            'EFX': 'Equifax Inc.', 'FITB': 'Fifth Third Bancorp', 'ADM': 'Archer-Daniels-Midland Company', 'BR': 'Broadridge Financial Solutions, Inc.', 
            'HPE': 'Hewlett Packard Enterprise Company', 'DXCM': 'DexCom, Inc.', 'AWK': 'American Water Works Company, Inc.', 'WBD': 'Warner Bros. Discovery, Inc.', 
            'STZ': 'Constellation Brands, Inc.', 'SYF': 'Synchrony Financial', 'DTE': 'DTE Energy Company', 'NRG': 'NRG Energy, Inc.', 'KEYS': 'Keysight Technologies, Inc.', 
            'WDC': 'Western Digital Corporation', 'AVB': 'AvalonBay Communities, Inc.', 'IBKR': 'Interactive Brokers Group, Inc.', 'K': 'Kellanova', 'ROL': 'Rollins, Inc.', 
            'IRM': 'Iron Mountain Incorporated', 'WRB': 'W. R. Berkley Corporation', 'AEE': 'Ameren Corporation', 'PPL': 'PPL Corporation', 'MTD': 'Mettler-Toledo International Inc.', 
            'TTD': 'The Trade Desk, Inc.', 'HPQ': 'HP Inc.', 'ATO': 'Atmos Energy Corporation', 'FOXA': 'Fox Corporation', 'EXPE': 'Expedia Group, Inc.', 
            'GIS': 'General Mills, Inc.', 'VLTO': 'Veralto Corporation', 'IP': 'International Paper Company', 'HBAN': 'Huntington Bancshares Incorporated', 
            'PHM': 'PulteGroup, Inc.', 'EQR': 'Equity Residential', 'PTC': 'PTC Inc.', 'VRSN': 'VeriSign, Inc.', 'FOX': 'Fox Corporation', 'TDY': 'Teledyne Technologies Incorporated', 
            'FE': 'FirstEnergy Corp.', 'PPG': 'PPG Industries, Inc.', 'NTRS': 'Northern Trust Corporation', 'SMCI': 'Super Micro Computer, Inc.', 'CBOE': 'Cboe Global Markets, Inc.', 
            'SW': 'Smurfit Westrock Plc', 'CNP': 'CenterPoint Energy, Inc.', 'DOV': 'Dover Corporation', 'RF': 'Regions Financial Corporation', 'TYL': 'Tyler Technologies, Inc.', 'STE': 'STERIS plc', 'DRI': 'Darden Restaurants, Inc.', 
            'CINF': 'Cincinnati Financial Corporation', 'DG': 'Dollar General Corporation', 'PODD': 'Insulet Corporation', 'ES': 'Eversource Energy', 'TROW': 'T. Rowe Price Group, Inc.', 
            'NVR': 'NVR, Inc.', 'LDOS': 'Leidos Holdings, Inc.', 'LH': 'Labcorp Holdings Inc.', 'CPAY': 'Corpay, Inc.', 'EXE': 'Expand Energy Corporation', 
            'WSM': 'Williams-Sonoma, Inc.', 'HUBB': 'Hubbell Incorporated', 'CHD': 'Church & Dwight Co., Inc.', 
            'CFG': 'Citizens Financial Group, Inc.', 'NTAP': 'NetApp, Inc.', 'ULTA': 'Ulta Beauty, Inc.', 'SBAC': 'SBA Communications Corporation', 
            'JBL': 'Jabil Inc.', 'EIX': 'Edison International', 'CDW': 'CDW Corporation', 'GPN': 'Global Payments Inc.', 'TPL': 'Texas Pacific Land Corporation', 
            'CMS': 'CMS Energy Corporation', 'KEY': 'KeyCorp', 'TPR': 'Tapestry, Inc.', 'ZBH': 'Zimmer Biomet Holdings, Inc.', 'FSLR': 'First Solar, Inc.', 
            'GDDY': 'GoDaddy Inc.', 'DGX': 'Quest Diagnostics Incorporated', 'ON': 'ON Semiconductor Corporation', 'TSN': 'Tyson Foods, Inc.', 'L': 'Loews Corporation', 
            'NI': 'NiSource Inc.', 'AMCR': 'Amcor plc', 'LII': 'Lennox International Inc.', 'PKG': 'Packaging Corporation of America', 'GPC': 'Genuine Parts Company', 
            'HAL': 'Halliburton Company', 'STLD': 'Steel Dynamics, Inc.', 'INVH': 'Invitation Homes Inc.', 'TRMB': 'Trimble Inc.', 'IT': 'Gartner, Inc.', 
            'MKC': 'McCormick & Company, Incorporated', 'TER': 'Teradyne, Inc.', 'WY': 'Weyerhaeuser Company', 'CTRA': 'Coterra Energy Inc.', 
        };

        // Fetch stock data from Vercel API
        async function fetchStockData(symbol) {
            try {
                const response = await fetch(`${API_BASE_URL}/stocks?symbol=${symbol}`, {
                    method: 'GET',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();

                // Calculate intrinsic values using different models
                const dcfValue = calculateDCFValue(data);
                const peValue = calculatePEValue(data);
                const assetValue = calculateAssetValue(data);
                
                // Calculate average intrinsic value and status
                const values = [
                    { value: dcfValue, weight: 0.55 },
                    { value: peValue, weight: 0.30 },
                    { value: assetValue, weight: 0.15 }
                ].filter(v => v.value > 0);
                
                let avgIntrinsicValue = 0;
                let percentDiff = 0;
                
                if (values.length > 0) {
                    const totalWeight = values.reduce((sum, v) => sum + v.weight, 0);
                    
                    avgIntrinsicValue = values.reduce((sum, v) => {
                        return sum + (v.value * (v.weight / totalWeight));
                    }, 0);

                    percentDiff = ((avgIntrinsicValue - data.currentPrice) / data.currentPrice) * 100;
                }
                
                const status = Math.abs(percentDiff) < 10 ? "Fair Value" : 
                    percentDiff > 20 ? "Undervalued" : "Overvalued";

                return {
                    name: companyNames[symbol] || symbol,
                    ticker: symbol,
                    dcfValue: dcfValue,
                    peValue: peValue,
                    assetValue: assetValue,
                    currentPrice: data.currentPrice,
                    status: status,
                    percentDiff: percentDiff,
                    rawData: data // Store raw data for debugging
                };
            } catch (error) {
                console.error(`Error fetching data for ${symbol}:`, error);
                return {
                    name: companyNames[symbol] || symbol,
                    ticker: symbol,
                    dcfValue: 0,
                    peValue: 0,
                    assetValue: 0,
                    currentPrice: 0,
                    status: "API Error",
                    percentDiff: 0
                };
            }
        }

        function calculateDCFValue(data) {
            const { freeCashflow, sharesOutstanding, currentPrice } = data;
            
            if (!freeCashflow || !sharesOutstanding) {
                const growthRate = 0.05;
                const discountRate = 0.1;
                const projectedEPS = data.eps * Math.pow(1 + growthRate, 5);
                const terminalValue = projectedEPS / (discountRate - 0.02);
                return terminalValue * 0.8;
            }

            const fcfPerShare = freeCashflow / sharesOutstanding;
            const growthRate = Math.max(0.02, Math.min(0.15, data.profitMargins || 0.05));
            const discountRate = 0.08 + (data.beta || 1) * 0.06; // CAPM-based discount rate
            
            let dcfValue = 0;
            for (let year = 1; year <= 5; year++) {
                const projectedFCF = fcfPerShare * Math.pow(1 + growthRate, year);
                dcfValue += projectedFCF / Math.pow(1 + discountRate, year);
            }
            
            // Terminal value
            const terminalGrowth = 0.02;
            const terminalFCF = fcfPerShare * Math.pow(1 + growthRate, 5) * (1 + terminalGrowth);
            const terminalValue = (terminalFCF / (discountRate - terminalGrowth)) / Math.pow(1 + discountRate, 5);
            
            return dcfValue + terminalValue;
        }

        function calculatePEValue(data) {
            const {trailingPE, forwardPE, epsGrowth, currentPrice, epsTTM, pegRatio = null} = data;
            
            if (!trailingPE || !forwardPE || !epsGrowth || !epsTTM) {
                return currentPrice * 0.9;}
            
            if (trailingPE <= 0 || forwardPE <= 0 || epsTTM <= 0) {
                return currentPrice * 0.9;}
            
            let calculatedPEG;
            
            if (pegRatio && pegRatio > 0) {calculatedPEG = pegRatio;} 
            else {
                const growthRatePercent = epsGrowth * 100;
                calculatedPEG = trailingPE / growthRatePercent;
            }
            
            const expectedGrowthRate = trailingPE / calculatedPEG;
            
            const growthBasedFairPE = expectedGrowthRate;
            
            const blendedPE = (0.4 * trailingPE) + (0.6 * forwardPE);
            
            const fairPE = (blendedPE + growthBasedFairPE) / 2;
            
            const boundedFairPE = Math.min(50, Math.max(8, fairPE));
            
            const fairValue = epsTTM * boundedFairPE;
            
            const peValue = fairValue * 0.8;
            
            return peValue;
    }

        function calculateAssetValue(data) {
            const {
                bookValue,
                totalRevenue,
                sharesOutstanding,
                currentPrice,
                trailingPE,
                roe,
                revenueGrowth = 0.1, // default 10%
                discountRate = 0.1   // default 10%
                } = data;
            
            if (!sharesOutstanding || sharesOutstanding <= 0) {
                return currentPrice * 0.8; // fallback
            }
            
            const bookPerShare = bookValue || 0;
            const revenuePerShare = totalRevenue ? totalRevenue / sharesOutstanding : 0;
            const eps = trailingPE;
            
            let assetValue = 0;
            
            if (bookPerShare > 0 && roe) {
                assetValue = bookPerShare * (1 + roe);
            } else if (revenuePerShare > 0) {
                const projectedRevenue = revenuePerShare * Math.pow(1 + revenueGrowth, 5);
                assetValue = projectedRevenue / Math.pow(1 + discountRate, 5);
            } else if (eps > 0) {
                assetValue = eps * 15;
            } else {
                assetValue = currentPrice * 0.8; // fallback
            }
            
            return assetValue

        }

        
        // Enhanced Dividend Discount Model
        function calculateDDMValue(data) {
            const { dividendRate, dividendYield, currentPrice, beta } = data;
            
            if (!dividendRate || dividendRate <= 0) {
                // For non-dividend stocks, estimate based on earnings
                return data.eps * 12; // Simple earnings multiple
            }
            
            const dividendGrowthRate = Math.max(0.01, Math.min(0.08, 0.03)); // 1-8% growth
            const requiredReturn = 0.04 + (beta || 1) * 0.06; // Risk-adjusted return
            
            if (requiredReturn <= dividendGrowthRate) {
                return currentPrice * 1.1; // Fallback if model breaks down
            }
            
            return (dividendRate * (1 + dividendGrowthRate)) / (requiredReturn - dividendGrowthRate);
        }

        // Fetch all stock data
        async function fetchAllStockData() {
            const promises = stockSymbols.map(symbol => fetchStockData(symbol));
            const results = await Promise.allSettled(promises);
            
            return results.map((result, index) => {
                if (result.status === 'fulfilled') {
                    return result.value;
                } else {
                    console.error(`Failed to fetch ${stockSymbols[index]}:`, result.reason);
                    return {
                        name: companyNames[stockSymbols[index]] || stockSymbols[index],
                        ticker: stockSymbols[index],
                        dcfValue: 0,
                        peValue: 0,
                        assetValue: 0,
                        currentPrice: 0,
                        status: "Network Error",
                        percentDiff: 0
                    };
                }
            });
        }

        function formatCurrency(value) {
            return "$" + value.toFixed(2);
        }

        function formatPercentage(value) {
            return (value > 0 ? "+" : "") + value.toFixed(1) + "%";
        }

        function renderTable() {
            const tbody = document.getElementById('stockTableBody');
            
            if (stockData.length === 0) {
                tbody.innerHTML = '<tr><td colspan="8" class="loading"><div class="spinner"></div>Loading stock data...</td></tr>';
                return;
            }

            tbody.innerHTML = stockData.map(stock => {
                const percentClass = stock.percentDiff > 0 ? 'positive' : 'negative';
                const statusClass = stock.status === 'Undervalued' ? 'status-undervalued' : 'status-overvalued';
                
                return `
                    <tr>
                        <td>${stock.name}</td>
                        <td class="ticker">${stock.ticker}</td>
                        <td class="price">${formatCurrency(stock.dcfValue)}</td>
                        <td class="price">${formatCurrency(stock.peValue)}</td>
                        <td class="price">${formatCurrency(stock.assetValue)}</td>
                        <td class="price">${formatCurrency(stock.currentPrice)}</td>
                        <td><span class="${statusClass}">${stock.status}</span></td>
                        <td class="percentage ${percentClass}">${formatPercentage(stock.percentDiff)}</td>
                    </tr>
                `;
            }).join('');
        }

        function sortTable(columnIndex) {
            if (sortColumn === columnIndex) {
                sortDirection *= -1;
            } else {
                sortColumn = columnIndex;
                sortDirection = -1;
            }

            const keys = ['name', 'ticker', 'dcfValue', 'peValue', 'assetValue', 'currentPrice', 'status', 'percentDiff'];
            const key = keys[columnIndex];

            stockData.sort((a, b) => {
                let aVal = a[key];
                let bVal = b[key];

                // Handle numeric vs string comparison
                if (typeof aVal === 'string' && typeof bVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }

                if (aVal < bVal) return -1 * sortDirection;
                if (aVal > bVal) return 1 * sortDirection;
                return 0;
            });

            renderTable();
            updateSortArrows();
        }

        function updateSortArrows() {
            const arrows = document.querySelectorAll('.sort-arrow');
            arrows.forEach((arrow, index) => {
                if (index === sortColumn) {
                    arrow.textContent = sortDirection === -1 ? 'â†“' : 'â†‘';
                } else {
                    arrow.textContent = 'â†•';
                }
            });
        }

        function filterTable() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const rows = document.querySelectorAll('#stockTableBody tr');
            
            rows.forEach(row => {
                const text = row.textContent.toLowerCase();
                row.style.display = text.includes(searchTerm) ? '' : 'none';
            });
        }

        function refreshData() {
            // Show loading state
            document.getElementById('stockTableBody').innerHTML = 
                '<tr><td colspan="8" class="loading"><div class="spinner"></div>Fetching real-time data from Yahoo Finance...</td></tr>';
            
            // Fetch real data from Yahoo Finance
            fetchAllStockData()
                .then(data => {
                    stockData = data;
                    sortTable(sortColumn);
                })
                .catch(error => {
                    console.error('Error fetching stock data:', error);
                    document.getElementById('stockTableBody').innerHTML = 
                        '<tr><td colspan="8" class="loading" style="color: #f87171;">Error loading data. Please try again or check console for details.</td></tr>';
                });
        }

        // Initialize the application
        function init() {
            // Load initial data from Yahoo Finance
            refreshData();
            
            // Set up search functionality
            document.getElementById('searchInput').addEventListener('input', filterTable);
        }

        // Start the application
        init();
    </script>
</body>
</html>

















